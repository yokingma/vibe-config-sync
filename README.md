# claude-sync

Sync Claude Code (`~/.claude/`) configurations across multiple machines via Git.

## Problem

When using Claude Code on multiple machines, configurations like skills, commands, agents, plugins, and user preferences need to be manually replicated on each machine.

## What Gets Synced

| Content | Description |
|---------|-------------|
| `settings.json` | Plugin enable/disable flags |
| `CLAUDE.md` | User preferences and workflow guidelines |
| `skills/` | Skill definitions (SKILL.md + references + templates) |
| `commands/` | Custom slash commands |
| `agents/` | Agent definitions |
| `plugins/installed_plugins.json` | Plugin registry (machine paths stripped) |
| `plugins/known_marketplaces.json` | Plugin marketplace sources (machine paths stripped) |

**Not synced** (machine-specific / ephemeral / large): `plugins/cache/`, `projects/`, `telemetry/`, `session-env/`, `plans/`, `todos/`, `debug/`, `history.jsonl`, etc.

## Prerequisites

- `bash` 4+
- `jq` (recommended) or `python3` (fallback)
- `git`
- `claude` CLI (only needed for `--reinstall-plugins`)

## Quick Start

### Machine A (export)

```bash
git clone <your-repo-url> ~/claude-sync
cd ~/claude-sync
./claude-sync.sh export
git add -A && git commit -m "initial config export" && git push
```

### Machine B (import)

```bash
git clone <your-repo-url> ~/claude-sync
cd ~/claude-sync
./claude-sync.sh import
./claude-sync.sh import --reinstall-plugins  # first time only
```

## Commands

| Command | Description |
|---------|-------------|
| `./claude-sync.sh export` | Collect configs from `~/.claude/` into repo |
| `./claude-sync.sh import` | Restore configs from repo to `~/.claude/` |
| `./claude-sync.sh import --reinstall-plugins` | Restore + reinstall all plugins |
| `./claude-sync.sh status` | Show diff between local and repo configs |
| `./claude-sync.sh push` | export + git commit + git push |
| `./claude-sync.sh pull` | git pull + import |

## Daily Workflow

```bash
# After changing configs on Machine A
./claude-sync.sh push

# On Machine B, pull latest
./claude-sync.sh pull
```

## How It Works

- **Export** copies config files into `claude-config/`, stripping machine-specific paths from plugin JSON files. Skills that are symlinks (e.g., pointing to `~/.agents/skills/`) are recorded in `external-skills.json` instead of being copied.

- **Import** restores files from `claude-config/` to `~/.claude/`, recreates symlinks, and optionally reinstalls plugins via `claude plugin install`.

- **Backup** is created automatically at `~/.claude-backup/<timestamp>/` before every import.

## Repository Structure

```
claude-sync/
  claude-sync.sh            # Main sync script
  claude-config/             # Generated by export
    settings.json
    CLAUDE.md
    commands/
    agents/
    skills/
    plugins/
      installed_plugins.json
      known_marketplaces.json
  external-skills.json       # Symlink mappings for skills
  .gitignore
```

## License

MIT
